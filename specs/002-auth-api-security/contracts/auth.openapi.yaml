openapi: 3.0.3
info:
  title: Authentication API
  description: JWT-based authentication endpoints for user registration, login, and profile management
  version: 1.0.0
  contact:
    name: Todo App API

servers:
  - url: http://localhost:8001/api
    description: Local development server
  - url: https://api.example.com/api
    description: Production server

tags:
  - name: Authentication
    description: User authentication and registration endpoints

paths:
  /auth/register:
    post:
      tags:
        - Authentication
      summary: Register a new user
      description: Create a new user account with username, email, and password
      operationId: registerUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
            examples:
              valid:
                summary: Valid registration
                value:
                  username: "alice_dev"
                  email: "alice@example.com"
                  password: "SecurePass123"
      responses:
        '201':
          description: User successfully registered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RegisterResponse'
              examples:
                success:
                  summary: Successful registration
                  value:
                    user:
                      id: "550e8400-e29b-41d4-a716-446655440000"
                      email: "alice@example.com"
                      username: "alice_dev"
                      created_at: "2026-01-11T10:30:00Z"
                    message: "Registration successful"
        '400':
          description: Validation error (duplicate email/username, weak password, invalid format)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                duplicate_email:
                  summary: Email already registered
                  value:
                    type: "https://api.example.com/errors/validation"
                    title: "Validation Error"
                    status: 400
                    detail: "Email already registered"
                    instance: "/api/auth/register"
                duplicate_username:
                  summary: Username already taken
                  value:
                    type: "https://api.example.com/errors/validation"
                    title: "Validation Error"
                    status: 400
                    detail: "Username already taken"
                    instance: "/api/auth/register"
                weak_password:
                  summary: Password doesn't meet requirements
                  value:
                    type: "https://api.example.com/errors/validation"
                    title: "Validation Error"
                    status: 400
                    detail: "Password must contain at least one uppercase letter"
                    instance: "/api/auth/register"

  /auth/login:
    post:
      tags:
        - Authentication
      summary: User login
      description: Authenticate user with email and password, returns JWT token
      operationId: loginUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
            examples:
              valid:
                summary: Valid login
                value:
                  email: "alice@example.com"
                  password: "SecurePass123"
      responses:
        '200':
          description: Login successful, JWT token returned
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
              examples:
                success:
                  summary: Successful login
                  value:
                    access_token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                    token_type: "bearer"
                    expires_in: 86400
                    user:
                      id: "550e8400-e29b-41d4-a716-446655440000"
                      email: "alice@example.com"
                      username: "alice_dev"
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalid_credentials:
                  summary: Invalid email or password
                  value:
                    type: "https://api.example.com/errors/authentication"
                    title: "Authentication Failed"
                    status: 401
                    detail: "Invalid credentials"
                    instance: "/api/auth/login"
        '400':
          description: Missing required fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/logout:
    post:
      tags:
        - Authentication
      summary: User logout
      description: Logout user (client-side token clearing, no server-side action needed for stateless JWT)
      operationId: logoutUser
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Logout successful"
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/me:
    get:
      tags:
        - Authentication
      summary: Get current user
      description: Get authenticated user's profile information
      operationId: getCurrentUser
      security:
        - bearerAuth: []
      responses:
        '200':
          description: User profile retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfile'
              examples:
                success:
                  summary: Current user profile
                  value:
                    id: "550e8400-e29b-41d4-a716-446655440000"
                    email: "alice@example.com"
                    username: "alice_dev"
                    created_at: "2026-01-11T10:30:00Z"
        '401':
          description: Not authenticated or invalid token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                missing_token:
                  summary: Missing authentication token
                  value:
                    type: "https://api.example.com/errors/authentication"
                    title: "Authentication Required"
                    status: 401
                    detail: "Authentication required"
                    instance: "/api/auth/me"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    type: "https://api.example.com/errors/authentication"
                    title: "Invalid Token"
                    status: 401
                    detail: "Invalid authentication token"
                    instance: "/api/auth/me"

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtained from /auth/login endpoint

  schemas:
    RegisterRequest:
      type: object
      required:
        - username
        - email
        - password
      properties:
        username:
          type: string
          minLength: 3
          maxLength: 30
          pattern: '^[a-zA-Z0-9_]+$'
          description: Username (3-30 characters, alphanumeric and underscores only)
          example: "alice_dev"
        email:
          type: string
          format: email
          maxLength: 255
          description: User's email address
          example: "alice@example.com"
        password:
          type: string
          minLength: 8
          format: password
          description: Password (min 8 chars, 1 uppercase, 1 lowercase, 1 number)
          example: "SecurePass123"

    RegisterResponse:
      type: object
      properties:
        user:
          $ref: '#/components/schemas/UserProfile'
        message:
          type: string
          example: "Registration successful"

    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          description: User's email address
          example: "alice@example.com"
        password:
          type: string
          format: password
          description: User's password
          example: "SecurePass123"

    LoginResponse:
      type: object
      properties:
        access_token:
          type: string
          description: JWT access token
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTUwZTg0MDAtZTI5Yi00MWQ0LWE3MTYtNDQ2NjU1NDQwMDAwIiwiZW1haWwiOiJhbGljZUBleGFtcGxlLmNvbSIsInVzZXJuYW1lIjoiYWxpY2VfZGV2IiwiaWF0IjoxNzM2NTk1MDAwLCJleHAiOjE3MzY2ODE0MDB9.signature"
        token_type:
          type: string
          enum: ["bearer"]
          example: "bearer"
        expires_in:
          type: integer
          description: Token expiration time in seconds (24 hours = 86400)
          example: 86400
        user:
          $ref: '#/components/schemas/UserProfile'

    UserProfile:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: User's unique identifier
          example: "550e8400-e29b-41d4-a716-446655440000"
        email:
          type: string
          format: email
          description: User's email address
          example: "alice@example.com"
        username:
          type: string
          description: User's display name
          example: "alice_dev"
        created_at:
          type: string
          format: date-time
          description: Account creation timestamp (UTC)
          example: "2026-01-11T10:30:00Z"

    ErrorResponse:
      type: object
      description: RFC 7807 Problem Details error response
      properties:
        type:
          type: string
          format: uri
          description: URI reference identifying the problem type
          example: "https://api.example.com/errors/validation"
        title:
          type: string
          description: Short, human-readable summary of the problem
          example: "Validation Error"
        status:
          type: integer
          description: HTTP status code
          example: 400
        detail:
          type: string
          description: Human-readable explanation specific to this occurrence
          example: "Email already registered"
        instance:
          type: string
          format: uri
          description: URI reference identifying the specific occurrence
          example: "/api/auth/register"

security:
  - bearerAuth: []
